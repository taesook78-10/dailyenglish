<!DOCTYPE html>
<html lang="ko">
<head>
  <!--
    âœ… ì˜¤ëŠ˜ì˜ ì˜ì–´ í•™ìŠµ â€” ìµœì¢… index.html
    - topics.js(100ê°œ ì£¼ì œ Ã— ê° 21ë¬¸ì¥) ë¨¼ì € ë¡œë“œ
    - í•œêµ­ì‹œê°„(KST) ê¸°ì¤€ ìì •ë§ˆë‹¤ ìë™ìœ¼ë¡œ ë‹¤ìŒ ì£¼ì œë¡œ ì „í™˜
    - ë‹¤ì‹œí•˜ê¸°: 3ë¬¸ì¥ì”© 7íšŒ(=21ë¬¸ì¥) ìˆœí™˜
    - ì ìˆ˜ì¹©(ì™¼ìª½) & ì„±ê³µì¹©(ì˜¤ë¥¸ìª½): 80ì  ì´ìƒì´ë©´ ì„±ê³µì¹© ë…¸ì¶œ
    - í’ë¶€í•œ ê°€ë“œ(ë¡œë“œ ì‹¤íŒ¨/ë°ì´í„° ë¶ˆì¼ì¹˜ ì§„ë‹¨), ë””ë²„ê·¸ ëª¨ë“œ(?debug=1)
    - UIëŠ” ì‹¬í”Œí•˜ê³  ê°€ë²¼ìš´ ìŠ¤íƒ€ì¼. 'í™”ë©´ì€ ê¸°ì¡´ëŒ€ë¡œ' ìš”êµ¬ë¥¼ í•´ì¹˜ì§€ ì•Šë„ë¡ ìœ ì§€
  -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì˜¤ëŠ˜ì˜ ì˜ì–´ í•™ìŠµ</title>

  <!-- âœ… 1) topics.jsë¥¼ 'ë°˜ë“œì‹œ ë¨¼ì €' ë¡œë“œ (ì „ì—­ window.TITLES / window.TOPIC_BANKS ì œê³µ)
       - index.htmlê³¼ ê°™ì€ í´ë”ë¼ë©´ ./topics.js
       - ìºì‹œ ë¬´íš¨í™”ë¥¼ ìœ„í•´ v íŒŒë¼ë¯¸í„°ë¥¼ ê°€ë” ê°±ì‹ í•˜ì„¸ìš”.
  -->
  <script src="./topics.js?v=20250914"></script>

  <style>
    :root{
      --bg:#f8fafc; --fg:#0f172a; --card:#ffffff;
      --brand:#4f46e5; --brand-dark:#4338ca;
      --muted:#475569; --chip-green:#16a34a; --surface:#f1f5f9;
      --danger:#ef4444; --warn:#f59e0b; --ok:#16a34a;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--fg);
      font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    header{
      background:var(--brand); color:#fff; padding:1rem; text-align:center;
      font-weight:800; letter-spacing:.2px;
    }
    main{ max-width:900px; margin:auto; padding:1rem; }
    .card{
      background:var(--card); border-radius:18px;
      box-shadow:0 10px 30px rgba(2,6,23,.06);
      padding:1.5rem; margin:1.5rem 0;
    }
    .row{ display:flex; gap:.5rem; align-items:center; justify-content:flex-end; margin-bottom:.5rem; flex-wrap:wrap; }
    .chip{ display:inline-block; padding:.38rem .75rem; border-radius:9999px; font-size:.92rem; font-weight:700; }
    .chip.score{ background:var(--brand); color:#fff; }
    .chip.success{ background:var(--chip-green); color:#fff; }
    .meta{ font-size:.86rem; color:var(--muted); display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .meta .dot{ width:5px; height:5px; border-radius:50%; background:#cbd5e1; display:inline-block; }
    #topicTitle{ margin:.25rem 0 1rem; line-height:1.25; }
    .sentence{
      margin:.6rem 0; padding:.85rem .95rem; border-radius:10px; background:var(--surface);
      border:1px solid #e2e8f0;
    }
    .sentence b{ display:block; margin-bottom:.25rem }
    button{
      margin-top:1rem; background:var(--brand); color:#fff; border:none;
      padding:.75rem 1.1rem; border-radius:10px; font-size:1rem; cursor:pointer;
      transition:transform .02s ease-in-out, background .15s ease;
    }
    button:hover{ background:var(--brand-dark); }
    button:active{ transform:translateY(1px); }

    /* ë””ë²„ê·¸ íŒ¨ë„ (ì˜µì…˜) */
    #debug{
      display:none; margin-top:1rem; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      background:#0b1220; color:#e2e8f0; border-radius:12px; padding:1rem; overflow:auto;
    }
    #debug .k{ color:#93c5fd } /* key */
    #debug .v{ color:#a7f3d0 } /* value */
    #debug .warn{ color:#fde68a }
    #debug .err{ color:#fecaca }
    .help{
      color:#475569; font-size:.86rem; line-height:1.5; margin-top:.75rem;
    }
    .help code{ background:#e2e8f0; padding:.1rem .3rem; border-radius:6px; }
  </style>
</head>
<body>
  <header>ì˜¤ëŠ˜ì˜ ì˜ì–´ í•™ìŠµ</header>

  <main>
    <div class="card">
      <!-- âœ… ì ìˆ˜ì¹©(ì™¼ìª½) + ì„±ê³µì¹©(ì˜¤ë¥¸ìª½) -->
      <div class="row">
        <span id="scoreChip" class="chip score">ì ìˆ˜: 0%</span>
        <span id="successChip" class="chip success" style="display:none;">ì„±ê³µ ğŸ‰</span>
      </div>

      <div class="meta">
        <span>Day <span id="dayNum">1</span></span>
        <span class="dot"></span>
        <span>KST <span id="todayKST">â€”</span></span>
      </div>

      <h2 id="topicTitle">ì£¼ì œ</h2>

      <div id="sentences" aria-live="polite"></div>

      <button id="retryBtn" type="button" aria-label="ë‹¤ì‹œí•˜ê¸°: ë‹¤ìŒ 3ë¬¸ì¥ ë³´ê¸°">ë‹¤ì‹œí•˜ê¸° (3ë¬¸ì¥ êµì²´)</button>

      <div class="help">
        <div>â€¢ <b>ìì •(KST)</b>ì´ ë˜ë©´ ìë™ìœ¼ë¡œ ë‹¤ìŒ ì£¼ì œë¡œ ë³€ê²½ë¼ìš”.</div>
        <div>â€¢ <b>ë‹¤ì‹œí•˜ê¸°</b>ë¥¼ ëˆ„ë¥¼ ë•Œë§ˆë‹¤ <b>3ë¬¸ì¥ì”©</b> ë°”ë€Œê³ , 7ë²ˆ ëˆ„ë¥´ë©´ ë‹¤ì‹œ ì²˜ìŒìœ¼ë¡œ ìˆœí™˜í•´ìš”.</div>
        <div>â€¢ ì ìˆ˜ê°€ <b>80ì  ì´ìƒ</b>ì´ë©´ <b>ì„±ê³µ</b> ì¹©ì´ ì˜¤ë¥¸ìª½ì— í‘œì‹œë¼ìš”.</div>
      </div>

      <!-- ë””ë²„ê·¸ íŒ¨ë„: URLì— ?debug=1ë¥¼ ë¶™ì´ë©´ í™œì„±í™”ë©ë‹ˆë‹¤ -->
      <pre id="debug"></pre>
    </div>
  </main>

  <script>
    // ============================================
    // 0) ìœ í‹¸: ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°, ì•ˆì „í•œ í…ìŠ¤íŠ¸, ë¡œê·¸
    // ============================================
    const qp = new URLSearchParams(location.search);
    const DEBUG = qp.get("debug")==="1";

    function safeText(s){ return String(s).replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m])); }
    function logDebug(lines){
      if(!DEBUG) return;
      const el = document.getElementById("debug");
      el.style.display="block";
      const out = Array.isArray(lines) ? lines.join("\n") : String(lines);
      el.textContent += out + "\n";
    }

    // ============================================
    // 1) topics.js ë¡œë“œ ê°€ë“œ (ì „ì—­ window.TITLES / window.TOPIC_BANKS)
    // ============================================
    (function guardTopics(){
      if (!window || !Array.isArray(window.TITLES) || !window.TITLES.length || !window.TOPIC_BANKS) {
        console.error("[topics] topics.js ë¡œë“œ ì‹¤íŒ¨: ê²½ë¡œ/ìºì‹œ/ë¡œë“œìˆœì„œë¥¼ í™•ì¸í•˜ì„¸ìš”.");
        const hint = [
          "âš ï¸ topics.js ë¡œë“œ ì‹¤íŒ¨ë¡œ ê¸°ë³¸ ë°ì´í„°ë¥¼ ì„ì‹œ ì‚¬ìš©í•©ë‹ˆë‹¤.",
          "Â· index.htmlê³¼ topics.jsê°€ ê°™ì€ í´ë”ì¸ì§€ í™•ì¸",
          "Â· <script src=\"./topics.js?v=ë‚ ì§œ\">ë¥¼ ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ë³´ë‹¤ ë¨¼ì € ë‘ ",
          "Â· ë¸Œë¼ìš°ì € ìºì‹œ ì‚­ì œ ë˜ëŠ” ì¿¼ë¦¬ìŠ¤íŠ¸ë§ ê°±ì‹ ",
          "Â· file:// ëŒ€ì‹  ê°„ë‹¨ ì„œë²„ ê¶Œì¥ (ì˜ˆ: npx serve, python -m http.server)"
        ];
        if(!DEBUG) alert(hint.join("\n"));
        logDebug(hint);

        // ì•ˆì „ë§: ì•±ì´ ì£½ì§€ ì•Šë„ë¡ ì„ì‹œ 1í† í”½/21ë¬¸ì¥ ì œê³µ
        window.TITLES = ["Coffee Break"];
        window.TOPIC_BANKS = {
          "Coffee Break": Array.from({length:21}, (_,i)=>({
            en:`I enjoyed a simple coffee today. (${i+1})`,
            ko:`ì˜¤ëŠ˜ì€ ì»¤í”¼ë¥¼ ê°„ë‹¨íˆ ì¦ê²¼ì–´ìš”. (${i+1})`
          }))
        };
      }
    })();

    // ============================================
    // 2) KST(UTC+9) ë‚ ì§œ/ì‹œê°„
    // ============================================
    function kstNow(){
      const now = new Date();
      const utc = now.getTime() + now.getTimezoneOffset()*60000;
      return new Date(utc + 9*60*60000);
    }
    function fmtKst(d){
      // YYYY-MM-DD HH:mm:ss (KST)
      const z = n=>String(n).padStart(2,"0");
      return `${d.getFullYear()}-${z(d.getMonth()+1)}-${z(d.getDate())} ${z(d.getHours())}:${z(d.getMinutes())}:${z(d.getSeconds())}`;
    }
    function todayKeyKST(){ return kstNow().toISOString().slice(0,10); } // YYYY-MM-DD

    // ============================================
    // 3) ì§„í–‰ ìƒíƒœ (LocalStorage)
    // ============================================
    const LS_KEY="eng_app_progress_v2";
    const saved = JSON.parse(localStorage.getItem(LS_KEY) || "{}");
    if (!saved.startDate) {
      saved.startDate = todayKeyKST();               // ìµœì´ˆ ì ‘ì†í•œ KST ë‚ ì§œê°€ Day 1ì˜ ì‹œì‘
      saved.scoreByDate = {};                        // ì„ íƒ: ë‚ ì§œë³„ ì ìˆ˜ ê¸°ë¡ (í™•ì¥ ì—¬ì§€)
      localStorage.setItem(LS_KEY, JSON.stringify(saved));
    }

    function computeDayFromStart(){
      // ì‹œì‘ì¼ì˜ KST ìì • ê¸°ì¤€ìœ¼ë¡œ ê²½ê³¼ ì¼ìˆ˜ ê³„ì‚°
      const start = new Date(saved.startDate + "T00:00:00+09:00");
      const diffDays = Math.floor((kstNow() - start) / 86400000);
      return Math.max(1, diffDays + 1); // Day 1ë¶€í„° ì‹œì‘
    }

    // ============================================
    // 4) ë°ì´í„° ì ‘ê·¼ì
    // ============================================
    const TITLES = window.TITLES;           // 100ê°œ ì£¼ì œ
    const BANKS  = window.TOPIC_BANKS;      // { title: [ {en,ko} Ã— 21 ] }

    function validateBanks(){
      // ì§„ë‹¨: ì£¼ì œ ìˆ˜ì™€ ê° ë±…í¬ì˜ ë¬¸ì¥ ìˆ˜ í™•ì¸
      const issues = [];
      if(!Array.isArray(TITLES)) issues.push("TITLESê°€ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤.");
      if(Array.isArray(TITLES) && TITLES.length!==100){
        issues.push(`TITLES ê¸¸ì´ = ${TITLES.length} (ì˜ˆìƒ: 100)`);
      }
      let bad = 0;
      (TITLES||[]).forEach(t=>{
        const arr = (BANKS && BANKS[t]) || [];
        if(arr.length!==21){ bad++; issues.push(`"${t}" ë¬¸ì¥ ìˆ˜ = ${arr.length} (ì˜ˆìƒ: 21)`); }
      });
      if(issues.length){
        logDebug(["[ê²€ì¦] ì£¼ì œ/ë¬¸ì¥ ì§„ë‹¨:", ...issues]);
      }else{
        logDebug(["[ê²€ì¦] ëª¨ë“  ì£¼ì œ(100)ì™€ ë¬¸ì¥(ê° 21ê°œ) ì •ìƒ âœ…"]);
      }
    }

    function bank21(title){
      const arr = (BANKS && BANKS[title]) || [];
      if (arr.length === 21) return arr;
      // ì•ˆì „ë§: ë¶€ì¡±í•˜ë©´ ì¦‰ì‹œ ë³´ì¶©(ì•± ì¤‘ë‹¨ ë°©ì§€)
      return Array.from({length:21}, (_,i)=>({
        en:`I studied ${title} today. (${i+1})`,
        ko:`ì˜¤ëŠ˜ ${title}ë¥¼(ì„) ê³µë¶€í–ˆì–´ìš”. (${i+1})`
      }));
    }

    // ============================================
    // 5) ìƒíƒœ & DOM ì°¸ì¡°
    // ============================================
    let score = 0;     // 0~100 (ì˜ˆì‹œ ê°€ì  ë¡œì§ ì‚¬ìš©)
    let offset = 0;    // 0,3,6,...,18 (3ë¬¸ì¥ì”© 7íšŒ ìˆœí™˜)
    let lastDate = todayKeyKST();

    const $dayNum = document.getElementById("dayNum");
    const $todayKST = document.getElementById("todayKST");
    const $topicTitle = document.getElementById("topicTitle");
    const $sentences = document.getElementById("sentences");
    const $scoreChip = document.getElementById("scoreChip");
    const $successChip = document.getElementById("successChip");
    const $retryBtn = document.getElementById("retryBtn");

    // ============================================
    // 6) ë Œë”ë§
    // ============================================
    function currentTitleByDay(day){
      // dayëŠ” 1ë¶€í„° ì‹œì‘, TITLES.lengthë¡œ ìˆœí™˜
      return TITLES[(day - 1) % TITLES.length] || "â€”";
    }

    function render(){
      const day = computeDayFromStart();
      const title = currentTitleByDay(day);

      $dayNum.textContent = day;
      const now = kstNow();
      $todayKST.textContent = fmtKst(now);
      $topicTitle.textContent = title;

      const bank = bank21(title);
      const group = [ bank[(offset+0)%21], bank[(offset+1)%21], bank[(offset+2)%21] ];

      $sentences.innerHTML = "";
      group.forEach(s=>{
        const div = document.createElement("div");
        div.className = "sentence";
        div.innerHTML = `<b>${safeText(s.en)}</b>${safeText(s.ko)}`;
        $sentences.appendChild(div);
      });

      // ì ìˆ˜ì¹© ì—…ë°ì´íŠ¸ + ì„±ê³µì¹©(ì˜¤ë¥¸ìª½) ë…¸ì¶œ
      $scoreChip.textContent = `ì ìˆ˜: ${score}%`;
      $successChip.style.display = (score >= 80) ? "inline-block" : "none";

      // ë””ë²„ê·¸ ì •ë³´
      logDebug([
        "---- RENDER ----",
        `day: ${day}`,
        `title: ${title}`,
        `offset: ${offset} (group indices: ${(offset+0)%21}, ${(offset+1)%21}, ${(offset+2)%21})`,
        `score: ${score}%`,
        `time(KST): ${fmtKst(now)}`
      ]);
    }

    // ============================================
    // 7) ì´ë²¤íŠ¸: ë‹¤ì‹œí•˜ê¸°(3ë¬¸ì¥ Ã— 7íšŒ ìˆœí™˜)
    // ============================================
    $retryBtn.addEventListener("click", ()=>{
      offset = (offset + 3) % 21;           // 0â†’3â†’6â†’â€¦â†’18â†’0
      score = Math.min(100, score + 10);    // ì˜ˆì‹œ ê°€ì (ì›í•˜ì‹œë©´ ì‹¤ì œ ì±„ì  ë¡œì§ìœ¼ë¡œ êµì²´)
      render();
    });

    // ============================================
    // 8) KST ìì • ì²´í¬(1ì´ˆ ê°„ê²© ì‹œê³„ + 1ë¶„ ê°„ê²© ë‚ ì§œ ì „í™˜)
    //    - ì‹œê³„: ë§¤ì´ˆ ê°±ì‹ 
    //    - ë‚ ì§œ ë°”ë€Œë©´(ìì •) ì£¼ì œ/ì ìˆ˜/ì˜¤í”„ì…‹ ì´ˆê¸°í™”
    // ============================================
    setInterval(()=>{ // ì‹œê³„
      $todayKST.textContent = fmtKst(kstNow());
    }, 1000);

    setInterval(()=>{ // ìì • ê°ì§€
      const nowKey = todayKeyKST();
      if (nowKey !== lastDate) {
        lastDate = nowKey;
        offset = 0;  // ìƒˆ ë‚ ì—” ì²« 3ë¬¸ì¥ë¶€í„°
        score  = 0;  // ì ìˆ˜ ë¦¬ì…‹(ì •ì±…ì— ë§ì¶° ì¡°ì • ê°€ëŠ¥)
        render();
      }
    }, 60 * 1000);

    // ============================================
    // 9) ì´ˆê¸°í™”
    // ============================================
    try { validateBanks(); } catch(e){ logDebug(["[ê²€ì¦ ì˜¤ë¥˜]", String(e)]); }
    render();

    // ============================================
    // 10) ì¶”ê°€ ë„ì›€ë§: ë¡œë“œ ë¬¸ì œ í•´ê²° ê°€ì´ë“œ (ë””ë²„ê·¸ ëª¨ë“œì—ì„œë§Œ)
    // ============================================
    if (DEBUG) {
      const tips = [
        "",
        "=== ë¡œë“œ ì§„ë‹¨ ê°€ì´ë“œ ===",
        "- topics.jsê°€ index.htmlë³´ë‹¤ ë¨¼ì € ë¡œë“œë˜ëŠ”ì§€ í™•ì¸ (<head> ìƒë‹¨)",
        "- ê²½ë¡œ: index.htmlê³¼ ê°™ì€ í´ë”ë©´ src=\"./topics.js\"",
        "- ìºì‹œ: ì¿¼ë¦¬ìŠ¤íŠ¸ë§ ê°±ì‹  (?v=yyyyMMdd ë“±) ë˜ëŠ” ê°•ë ¥ ìƒˆë¡œê³ ì¹¨",
        "- ë¡œì»¬ íŒŒì¼(file://) ëŒ€ì‹  ê°„ë‹¨ ì„œë²„ì—ì„œ ì—´ê¸° (CORS/ëª¨ë“ˆ ì´ìŠˆ íšŒí”¼)",
        "- ì½˜ì†” ì—ëŸ¬ í™•ì¸(F12)"
      ];
      logDebug(tips);
    }
  </script>
</body>
</html>

