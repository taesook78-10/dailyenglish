<!DOCTYPE html>
<html lang="ko">
  <script src="topics.js"></script>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>영어 학습 앱</title>
  <style>
    body {
      font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, sans-serif;
      margin: 0;
      padding: 0;
      background: #f8fafc;
      color: #0f172a;
    }
    header {
      background: #4f46e5;
      color: white;
      padding: 1rem;
      text-align: center;
      font-size: 1.2rem;
    }
    main {
      padding: 1rem;
      max-width: 700px;
      margin: auto;
    }
    .card {
      background: white;
      border-radius: 18px;
      box-shadow: 0 10px 30px rgba(2,6,23,.06);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    .chip-row {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }
    .chip {
      display: inline-block;
      padding: 0.3rem 0.7rem;
      border-radius: 9999px;
      font-size: 0.9rem;
      font-weight: 600;
    }
    .success {
      background: #16a34a;
      color: white;
    }
    .score {
      background: #4f46e5;
      color: white;
    }
    .sentence {
      margin: 0.6rem 0;
      padding: 0.8rem;
      background: #f1f5f9;
      border-radius: 10px;
    }
    button {
      margin-top: 1rem;
      background: #4f46e5;
      color: white;
      border: none;
      padding: 0.7rem 1.2rem;
      border-radius: 10px;
      font-size: 1rem;
      cursor: pointer;
    }
    button:hover {
      background: #4338ca;
    }
  </style>
  <!-- 21문장 세트 topics.js 먼저 불러오기 -->
  <script src="topics.js"></script>
</head>
<body>
  <header>오늘의 영어 학습</header>
  <main>
    <div class="card">
      <div class="chip-row">
        <div id="successChip" class="chip success" style="display:none;">성공 🎉</div>
        <div id="scoreChip" class="chip score">점수: 0</div>
      </div>
      <h2 id="topicTitle">주제</h2>
      <div id="sentences"></div>
      <button id="retryBtn">다시하기</button>
    </div>
  </main>

  <script>
    const TITLES = window.TITLES;
    const BANKS = window.TOPIC_BANKS;

    let currentDayIndex = 0;
    let sentenceIndex = 0;
    let score = 0;

    // 한국시간 기준 자정마다 새로운 주제로 변경
    function getKSTDate() {
      const now = new Date();
      const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
      const kst = new Date(utc + (9 * 60 * 60000));
      return kst;
    }

    function getDayIndex() {
      const start = new Date("2025-01-01T00:00:00+09:00"); // 기준일
      const now = getKSTDate();
      const diff = Math.floor((now - start) / (1000*60*60*24));
      return diff % TITLES.length;
    }

    function loadTopic() {
      currentDayIndex = getDayIndex();
      const topic = TITLES[currentDayIndex];
      document.getElementById("topicTitle").innerText = topic;
      sentenceIndex = 0;
      renderSentences();
    }

    function renderSentences() {
      const topic = TITLES[currentDayIndex];
      const bank = BANKS[topic] || [];
      const container = document.getElementById("sentences");
      container.innerHTML = "";

      const chunk = bank.slice(sentenceIndex, sentenceIndex+3);
      chunk.forEach(s => {
        const div = document.createElement("div");
        div.className = "sentence";
        div.innerHTML = `<b>${s.en}</b><br/>${s.ko}`;
        container.appendChild(div);
      });

      sentenceIndex += 3;
      if (sentenceIndex >= bank.length) sentenceIndex = 0;
    }

    function updateScore(points) {
      score += points;
      document.getElementById("scoreChip").innerText = `점수: ${score}`;
      if (score >= 80) {
        document.getElementById("successChip").style.display = "inline-block";
      } else {
        document.getElementById("successChip").style.display = "none";
      }
    }

    document.getElementById("retryBtn").addEventListener("click", () => {
      renderSentences();
      updateScore(10); // 예시: 문장 묶음 볼 때마다 10점 추가
    });

    // 초기 로드
    loadTopic();
  </script>
</body>
</html>
