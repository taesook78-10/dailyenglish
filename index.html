<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì˜¤ëŠ˜ì˜ ì˜ì–´ í•™ìŠµ</title>

  <!-- âœ… (ë³€ê²½) topics.jsë¥¼ ë¨¼ì € ë¡œë“œ -->
  <script src="./topics.js?v=20250915"></script>

  <!-- âœ… (ë³€ê²½) SHIM: TOPICS â†’ TITLES / TOPIC_BANKS ë§¤í•‘
       - ì´ˆê³¼ë¶„ë§Œ .slice(0,21)ë¡œ ìë¥´ê³ 
       - â›” ë¶€ì¡±ë¶„ ìë™ ì±„ì›€(placeholder) ì œê±° -->
  <script>
  (function(){
    if (!Array.isArray(window.TOPICS)) {
      console.error("[topics] window.TOPICSê°€ ì—†ìŠµë‹ˆë‹¤. topics.jsë¥¼ ë¨¼ì € ë¡œë“œí–ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.");
      return;
    }
    // ê¸°ì¡´ ì½”ë“œ í˜¸í™˜: ì£¼ì œ ëª©ë¡
    window.TITLES = window.TOPICS.map(t => t.topic);

    // ê¸°ì¡´ ì½”ë“œ í˜¸í™˜: ì£¼ì œë³„ ë¬¸ì¥ ë±…í¬ [{en,ko}] ë°°ì—´
    const banks = {};
    for (const item of window.TOPICS) {
      const arr = Array.isArray(item.sentences) ? item.sentences : [];
      let mapped = arr.map(s =>
        (typeof s === "string")
          ? ({ en: String(s), ko: "" })
          : ({ en: (s && s.en) ? String(s.en) : "", ko: (s && s.ko) ? String(s.ko) : "" })
      );
      // â¬‡ï¸ 21ê°œ ì´ˆê³¼ë§Œ ìë¥´ê¸° (ë¶€ì¡±ë¶„ ìë™ ë³´ì¶© ì œê±°)
      mapped = mapped.slice(0, 21);

      banks[item.topic] = mapped;
    }
    window.TOPIC_BANKS = banks;
  })();
  </script>

  <!-- â–¼â–¼â–¼ ì´í•˜: ê¸°ì¡´ í™”ë©´/ìŠ¤íƒ€ì¼ ê·¸ëŒ€ë¡œ (ì†ëŒ€ì§€ ì•ŠìŒ) â–¼â–¼â–¼ -->
  <style>
    :root{
      --bg:#f8fafc; --fg:#0f172a; --card:#ffffff;
      --brand:#4f46e5; --brand-dark:#4338ca;
      --muted:#475569; --chip-green:#16a34a; --surface:#f1f5f9;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--fg);
      font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, sans-serif;
    }
    header{
      background:var(--brand); color:#fff; padding:1rem; text-align:center;
      font-weight:800; letter-spacing:.2px;
    }
    main{ max-width:900px; margin:auto; padding:1rem; }
    .card{
      background:var(--card); border-radius:18px;
      box-shadow:0 10px 30px rgba(2,6,23,.06);
      padding:1.5rem; margin:1.5rem 0;
    }
    .row{ display:flex; gap:.5rem; align-items:center; justify-content:flex-end; margin-bottom:.5rem; flex-wrap:wrap; }
    .chip{ display:inline-block; padding:.38rem .75rem; border-radius:9999px; font-size:.92rem; font-weight:700; }
    .chip.score{ background:var(--brand); color:#fff; }
    .chip.success{ background:var(--chip-green); color:#fff; }
    .meta{ font-size:.86rem; color:var(--muted); display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .meta .dot{ width:5px; height:5px; border-radius:50%; background:#cbd5e1; display:inline-block; }
    #topicTitle{ margin:.25rem 0 1rem; line-height:1.25; }
    .sentence{
      margin:.6rem 0; padding:.85rem .95rem; border-radius:10px; background:var(--surface);
      border:1px solid #e2e8f0;
    }
    .sentence b{ display:block; margin-bottom:.25rem }
    button{
      margin-top:1rem; background:var(--brand); color:#fff; border:none;
      padding:.75rem 1.1rem; border-radius:10px; font-size:1rem; cursor:pointer;
      transition:transform .02s ease-in-out, background .15s ease;
    }
    button:hover{ background:var(--brand-dark); }
    button:active{ transform:translateY(1px); }
  </style>
</head>
<body>
  <header>ì˜¤ëŠ˜ì˜ ì˜ì–´ í•™ìŠµ</header>

  <main>
    <div class="card">
      <!-- ì ìˆ˜ì¹©(ì™¼ìª½) + ì„±ê³µì¹©(ì˜¤ë¥¸ìª½) : ê¸°ì¡´ ìœ ì§€ -->
      <div class="row">
        <span id="scoreChip" class="chip score">ì ìˆ˜: 0%</span>
        <span id="successChip" class="chip success" style="display:none;">ì„±ê³µ ğŸ‰</span>
      </div>

      <div class="meta">
        <span>Day <span id="dayNum">1</span></span>
        <span class="dot"></span>
        <span>KST <span id="todayKST">â€”</span></span>
      </div>

      <h2 id="topicTitle">ì£¼ì œ</h2>

      <div id="sentences" aria-live="polite"></div>

      <button id="retryBtn" type="button" aria-label="ë‹¤ì‹œí•˜ê¸°: ë‹¤ìŒ 3ë¬¸ì¥ ë³´ê¸°">ë‹¤ì‹œí•˜ê¸° (3ë¬¸ì¥ êµì²´)</button>
    </div>
  </main>

  <!-- â–¼â–¼â–¼ ì´í•˜: ê¸°ì¡´ ìŠ¤í¬ë¦½íŠ¸ ë¡œì§ ê·¸ëŒ€ë¡œ (ì†ëŒ€ì§€ ì•ŠìŒ) â–¼â–¼â–¼ -->
  <script>
    // í•œêµ­ì‹œê°„
    function kstNow(){
      const now = new Date();
      const utc = now.getTime() + now.getTimezoneOffset()*60000;
      return new Date(utc + 9*60*60000);
    }
    function fmtKst(d){
      const z = n=>String(n).padStart(2,"0");
      return `${d.getFullYear()}-${z(d.getMonth()+1)}-${z(d.getDate())} ${z(d.getHours())}:${z(d.getMinutes())}:${z(d.getSeconds())}`;
    }
    function todayKeyKST(){ return kstNow().toISOString().slice(0,10); }

    // ì§„í–‰ ìƒíƒœ
    const LS_KEY="eng_app_progress_v2";
    const saved = JSON.parse(localStorage.getItem(LS_KEY) || "{}");
    if (!saved.startDate) {
      saved.startDate = todayKeyKST();
      saved.scoreByDate = {};
      localStorage.setItem(LS_KEY, JSON.stringify(saved));
    }
    function computeDayFromStart(){
      const start = new Date(saved.startDate + "T00:00:00+09:00");
      const diffDays = Math.floor((kstNow() - start) / 86400000);
      return Math.max(1, diffDays + 1);
    }

    // ë°ì´í„° ì ‘ê·¼ì (ê¸°ì¡´ ì‚¬ìš© ë°©ì‹ ìœ ì§€)
    // TITLES, TOPIC_BANKS ëŠ” ìœ„ì˜ SHIMì—ì„œ ì„¸íŒ…ë¨
    function bank21(title){
      // â¬‡ï¸ ì™¸ë¶€ ë±…í¬ê°€ ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ë°˜í™˜
      if (window.TOPIC_BANKS && Array.isArray(window.TOPIC_BANKS[title])) {
        return window.TOPIC_BANKS[title];
      }
      // â›” ìë™ ì±„ì›€(placeholder) ì œê±°: ë” ì´ìƒ ì—¬ê¸°ì„œ ì„ì˜ ìƒì„±í•˜ì§€ ì•ŠìŒ
      return [];
    }

    // ìƒíƒœ & DOM
    let score = 0;
    let offset = 0;    // 0,3,6,...,18
    let lastDate = todayKeyKST();

    const $dayNum = document.getElementById("dayNum");
    const $todayKST = document.getElementById("todayKST");
    const $topicTitle = document.getElementById("topicTitle");
    const $sentences = document.getElementById("sentences");
    const $scoreChip = document.getElementById("scoreChip");
    const $successChip = document.getElementById("successChip");
    const $retryBtn = document.getElementById("retryBtn");

    function currentTitleByDay(day){
      // TITLESê°€ ì—†ë‹¤ë©´ ì•ˆì „ë§ìœ¼ë¡œ ë¹ˆ ë¬¸ìì—´
      const titles = Array.isArray(window.TITLES) ? window.TITLES : [];
      return titles[(day - 1) % (titles.length || 1)] || "";
    }

    function render(){
      const day = computeDayFromStart();
      const title = currentTitleByDay(day);

      $dayNum.textContent = day;
      const now = kstNow();
      $todayKST.textContent = fmtKst(now);
      $topicTitle.textContent = title || "ì£¼ì œ";

      const bank = bank21(title);
      $sentences.innerHTML = "";

      // â›” ì—¬ê¸°ì„œë„ ìë™ ì±„ì›€ ê¸ˆì§€: bankê°€ 21 ë¯¸ë§Œì´ë©´ ìˆëŠ” ë§Œí¼ë§Œ í‘œì‹œ
      const group = [ bank[(offset+0)%21], bank[(offset+1)%21], bank[(offset+2)%21] ]
        .filter(Boolean);

      group.forEach(s=>{
        const div = document.createElement("div");
        div.className = "sentence";
        div.innerHTML = `<b>${String(s.en || "").replace(/[&<>"']/g,(m=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[m])))}</b>${String(s.ko || "")}`;
        $sentences.appendChild(div);
      });

      $scoreChip.textContent = `ì ìˆ˜: ${score}%`;
      $successChip.style.display = (score >= 80) ? "inline-block" : "none";
    }

    $retryBtn.addEventListener("click", ()=>{
      offset = (offset + 3) % 21;
      score = Math.min(100, score + 10);
      render();
    });

    setInterval(()=>{ $todayKST.textContent = fmtKst(kstNow()); }, 1000);
    setInterval(()=>{
      const nowKey = todayKeyKST();
      if (nowKey !== lastDate) {
        lastDate = nowKey;
        offset = 0;
        score  = 0;
        render();
      }
    }, 60 * 1000);

    render();
  </script>
</body>
</html>
