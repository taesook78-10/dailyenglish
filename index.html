<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì˜ì–´ ë§í•˜ê¸° ì±Œë¦°ì§€ â€” Daily Topic & Lines</title>
  <style>
    :root{
      --bg:#0b1020; --card:#121833; --ink:#e6ebff; --muted:#9aa7d6;
      --pri:#6ea8ff; --accent:#ffd166; --ok:#22c55e;
      --radius:18px; --shadow:0 12px 36px rgba(0,0,0,.25);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:
      radial-gradient(1200px 600px at 10% 0%, #0f1a3b 0%, #0b1020 55%) fixed;
      font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
      color:var(--ink); display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .app{
      width:min(980px, 100%); background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.00));
      border:1px solid rgba(255,255,255,.08); border-radius:26px; box-shadow:var(--shadow); overflow:hidden;
    }
    header{
      padding:22px 24px; display:flex; gap:16px; align-items:center; justify-content:space-between;
      background:linear-gradient(180deg, rgba(110,168,255,.18), rgba(110,168,255,.05));
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .brand{display:flex; gap:12px; align-items:center}
    .logo{
      width:42px; height:42px; border-radius:12px; background:conic-gradient(from 220deg, var(--pri), #9bd2ff);
      box-shadow:0 6px 18px rgba(110,168,255,.35);
    }
    h1{font-size:20px; margin:0}
    .today{
      font-size:13px; color:var(--muted)
    }

    .controls{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:flex-end;
    }
    .pill{
      background:#0f1530; border:1px solid rgba(255,255,255,.10); color:var(--ink);
      padding:10px 14px; border-radius:999px; font-size:13px
    }
    .btn{
      background:var(--pri); color:#06142c; border:none; padding:10px 16px; border-radius:12px;
      font-weight:700; cursor:pointer; transition:transform .05s ease; font-size:14px;
    }
    .btn:active{ transform:translateY(1px) }
    .btn.secondary{
      background:#182043; color:var(--ink); border:1px solid rgba(255,255,255,.10);
      font-weight:600;
    }

    main{ padding:24px; display:grid; grid-template-columns: 1fr 380px; gap:18px }
    @media (max-width:900px){ main{ grid-template-columns:1fr } }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.00));
      border:1px solid rgba(255,255,255,.08);
      border-radius:22px; padding:18px; min-height:120px;
    }
    .topic{
      display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:10px
    }
    .topic-name{
      font-size:22px; font-weight:800; letter-spacing:.2px;
      display:flex; align-items:center; gap:10px;
    }
    .topic-name .tag{ font-size:12px; padding:6px 10px; border-radius:999px; background:#101941; border:1px solid rgba(255,255,255,.10); color:var(--muted) }
    .line{
      font-size:20px; line-height:1.6; padding:12px 14px; border-radius:16px;
      background:#0e1535; border:1px dashed rgba(255,255,255,.12); min-height:72px;
    }
    .hint{ color:var(--muted); font-size:13px; margin-top:8px }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:12px }

    .menu{ display:flex; gap:8px; flex-wrap:wrap }
    .menu button{
      background:#10173a; color:var(--ink); border:1px solid rgba(255,255,255,.10);
      padding:8px 12px; border-radius:12px; cursor:pointer; font-size:13px
    }
    .menu button.active{ outline:2px solid var(--accent); color:#0b1020; background:var(--accent); font-weight:800 }
    .meta{ font-size:12px; color:var(--muted); margin-left:6px }

    .side .card{ height:100% }
    .stat{ display:flex; justify-content:space-between; align-items:center; padding:10px 12px; border-radius:12px; background:#0f1738; border:1px solid rgba(255,255,255,.08); margin-bottom:10px }
    .stat b{ font-size:14px }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>ì˜ì–´ ë§í•˜ê¸° ì±Œë¦°ì§€</h1>
          <div class="today" id="todayStr">â€”</div>
        </div>
      </div>
      <div class="controls">
        <span class="pill" id="autoStatus">â± ë§¤ì¼ 00:00 ìë™ ì£¼ì œ ë³€ê²½ (KST)</span>
        <button class="btn secondary" id="nextLineBtn">ìƒˆ ë¬¸ì¥</button>
      </div>
    </header>

    <main>
      <section class="card">
        <div class="topic">
          <div class="topic-name">
            <span>ì˜¤ëŠ˜ì˜ ì£¼ì œ:</span>
            <span id="topicLabel">â€”</span>
            <span class="tag" id="topicTag">AUTO</span>
          </div>
          <div class="meta" id="progress">0 / 0</div>
        </div>
        <div class="line" id="lineBox">ë¬¸ì¥ì„ ë¶ˆëŸ¬ì˜¤ê³  ìˆì–´ìš”â€¦</div>
        <div class="hint">Tip: â€œìƒˆ ë¬¸ì¥â€ ë²„íŠ¼ìœ¼ë¡œ ê°™ì€ ì£¼ì œì˜ ë‹¤ìŒ ë¬¸ì¥ì„ ë°›ì•„ë³´ì„¸ìš”. (í•˜ë£¨ ë™ì•ˆì€ ì¤‘ë³µ ì—†ì´ ìˆœì„œ ì œê³µ)</div>

        <div class="row">
          <div class="menu" id="menu"></div>
        </div>
      </section>

      <aside class="side">
        <div class="card">
          <div class="stat"><span>ì£¼ì œ ìë™ ì„ íƒ ê¸°ì¤€</span><b id="baseDateInfo">â€”</b></div>
          <div class="stat"><span>ì˜¤ëŠ˜ì˜ ì£¼ì œ ì¸ë±ìŠ¤</span><b id="todayIdx">â€”</b></div>
          <div class="stat"><span>í˜„ì¬ ì„ íƒëœ ì£¼ì œ</span><b id="currentTopic">â€”</b></div>
          <div class="stat"><span>ì˜¤ëŠ˜ ì œê³µ ê°€ëŠ¥í•œ ë¬¸ì¥ ìˆ˜</span><b id="lineCount">â€”</b></div>
          <div class="stat"><span>ë‹¤ìŒ ìë™ ë³€ê²½ ì˜ˆì •</span><b id="nextMidnight">â€”</b></div>
        </div>
      </aside>
    </main>
  </div>

  <script>
    // ====== ìœ í‹¸: KST ë‚ ì§œ ë¬¸ìì—´(YYYY-MM-DD) ======
    const toKSTDateString = (d = new Date()) =>
      new Intl.DateTimeFormat('en-CA', { timeZone: 'Asia/Seoul', year:'numeric', month:'2-digit', day:'2-digit' }).format(d);

    // ====== ê¸°ì¤€ ì‹œì‘ì¼(ì›í•˜ì‹œë©´ ë°”ê¾¸ì…”ë„ ë©ë‹ˆë‹¤) ======
    const START_DATE_STR = '2025-01-01'; // KST ê¸°ì¤€
    const todayStrKST = toKSTDateString(new Date());
    document.getElementById('todayStr').textContent = `KST ${todayStrKST}`;

    // ====== í† í”½(ì£¼ì œ) ë° ë¬¸ì¥ ì„¸íŠ¸ ======
    // ê° í† í”½ì€ "ê·¸ í† í”½ì—ì„œ ì‹¤ì œë¡œ ì“¸ ë²•í•œ ë¬¸ì¥"ìœ¼ë¡œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.
    const TOPICS = [
      {
        key: 'coffee',
        label: 'â˜• Coffee',
        lines: [
          "Iâ€™d like a cup of coffee, please.",
          "Do you prefer hot coffee or iced coffee?",
          "Could I get a latte with an extra shot?",
          "This cafÃ© makes the best espresso in town.",
          "I usually take my coffee black in the morning.",
          "Is there any non-dairy milk available?",
          "Can I have it to go?",
          "What roast do you recommend for a smooth taste?",
          "Iâ€™m trying to cut down on caffeine this week.",
          "Could you make it less sweet, please?"
        ]
      },
      {
        key: 'commuting',
        label: 'ğŸš‡ Commuting',
        lines: [
          "I usually commute by subway.",
          "The traffic is terrible during rush hour.",
          "I transfer at City Hall to get to my office.",
          "I listen to podcasts while commuting.",
          "I try to leave earlier to avoid the crowd.",
          "The express train saves me about ten minutes.",
          "I missed the bus and had to wait for the next one.",
          "Do you know which line goes to Gangnam?",
          "I prefer standing near the door for a quick exit.",
          "I often read an e-book on the way."
        ]
      },
      {
        key: 'grocery',
        label: 'ğŸ›’ Grocery',
        lines: [
          "Where can I find the dairy section?",
          "Is there a discount on fresh produce today?",
          "Could you weigh these apples for me?",
          "Do you have any reusable bags?",
          "Iâ€™m looking for whole grain bread.",
          "Is there a self-checkout counter?",
          "Are these organic?",
          "Can I pay by card?",
          "Do you have a loyalty program?",
          "What time do you close on weekends?"
        ]
      },
      {
        key: 'smalltalk',
        label: 'ğŸ’¬ Small Talk',
        lines: [
          "Howâ€™s your day going so far?",
          "Thatâ€™s a great questionâ€”let me think.",
          "Have you tried the new place down the street?",
          "I totally agree with you on that.",
          "By the way, how was your weekend?",
          "Iâ€™ve been meaning to ask you about your project.",
          "Sounds good to me!",
          "Could you share your thoughts on this?",
          "Itâ€™s nice to finally meet you in person.",
          "Letâ€™s catch up later this week."
        ]
      },
      {
        key: 'school',
        label: 'ğŸ« School',
        lines: [
          "Please line up quietly, everyone.",
          "Letâ€™s review what we learned yesterday.",
          "Raise your hand if you have a question.",
          "Work with your partner for this activity.",
          "Weâ€™ll have a short quiz on Friday.",
          "Please submit your homework on time.",
          "Letâ€™s take a five-minute break.",
          "Share your ideas with the class.",
          "Remember to use your inside voice.",
          "Well done! Keep it up."
        ]
      }
    ];

    // ====== ë„ìš°ë¯¸: ì•ˆì •ì ì¸ 'í•˜ë£¨-í† í”½' ê³ ì • ì…”í”Œì„ ìœ„í•œ ì‹œë“œí˜• ëœë¤ ======
    // í•´ì‹œ â†’ ì‹œë“œ â†’ mulberry32 PRNG
    function cyrb128(str) {
      let h1 = 1779033703, h2 = 3144134277, h3 = 1013904242, h4 = 2773480762;
      for (let i = 0, k; i < str.length; i++) {
        k = str.charCodeAt(i);
        h1 = h2 ^ Math.imul(h1 ^ k, 597399067);
        h2 = h3 ^ Math.imul(h2 ^ k, 2869860233);
        h3 = h4 ^ Math.imul(h3 ^ k, 951274213);
        h4 = h1 ^ Math.imul(h4 ^ k, 2716044179);
      }
      h1 = Math.imul(h3 ^ (h1 >>> 18), 597399067);
      h2 = Math.imul(h4 ^ (h2 >>> 22), 2869860233);
      h3 = Math.imul(h1 ^ (h3 >>> 17), 951274213);
      h4 = Math.imul(h2 ^ (h4 >>> 19), 2716044179);
      let h = (h1 ^ h2 ^ h3 ^ h4) >>> 0;
      return h;
    }
    function mulberry32(a){ return function(){let t = a += 0x6D2B79F5; t = Math.imul(t ^ t >>> 15, t | 1); t ^= t + Math.imul(t ^ t >>> 7, t | 61); return ((t ^ t >>> 14) >>> 0) / 4294967296; } }

    function stableDailyShuffle(arr, seedStr){
      const seed = cyrb128(seedStr);
      const rand = mulberry32(seed);
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(rand() * (i+1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    // ====== ë‚ ì§œ â†’ ì¼ìˆ˜ ì°¨ì´ ======
    function daysBetweenUTC(yyyy_mm_dd_A, yyyy_mm_dd_B){
      const msA = Date.parse(yyyy_mm_dd_A); // UTCë¡œ íŒŒì‹±
      const msB = Date.parse(yyyy_mm_dd_B);
      return Math.floor((msB - msA) / 86400000);
    }

    // ====== ì˜¤ëŠ˜ì˜ ìë™ í† í”½ ì¸ë±ìŠ¤ ======
    function getTodayTopicIndex(){
      const days = daysBetweenUTC(START_DATE_STR, todayStrKST);
      return ((days % TOPICS.length) + TOPICS.length) % TOPICS.length;
    }

    // ====== ìƒíƒœ ======
    const state = {
      auto: true,                 // ìë™ ì£¼ì œ ëª¨ë“œ (ìƒì‹œ ON)
      topicIndex: 0,              // í˜„ì¬ ì„ íƒëœ í† í”½ ì¸ë±ìŠ¤
      todaysOrder: [],            // ì˜¤ëŠ˜ì˜ (í•´ë‹¹ í† í”½) ë¬¸ì¥ ìˆœì„œ(ì¤‘ë³µ ì—†ì´)
      pointer: 0,                 // ì˜¤ëŠ˜ ë³´ì—¬ì¤€ ê°œìˆ˜
    };

    // ====== UI ì°¸ì¡° ======
    const $menu = document.getElementById('menu');
    const $topicLabel = document.getElementById('topicLabel');
    const $topicTag = document.getElementById('topicTag');
    const $lineBox = document.getElementById('lineBox');
    const $progress = document.getElementById('progress');
    const $nextBtn = document.getElementById('nextLineBtn');
    const $baseDateInfo = document.getElementById('baseDateInfo');
    const $todayIdx = document.getElementById('todayIdx');
    const $currentTopic = document.getElementById('currentTopic');
    const $lineCount = document.getElementById('lineCount');
    const $nextMidnight = document.getElementById('nextMidnight');

    // ====== ë©”ë‰´ ìƒì„± ======
    function renderMenu(){
      $menu.innerHTML = '';
      TOPICS.forEach((t, idx) => {
        const b = document.createElement('button');
        b.textContent = `${idx+1}. ${t.label}`;
        b.dataset.idx = idx;
        b.addEventListener('click', () => {
          state.auto = false; // ìˆ˜ë™ ì„ íƒí•˜ë©´ ìë™ í‘œì‹œë§Œ OFF ìƒíƒœë¡œ ë³´ì—¬ì¤Œ(ìì •ë˜ë©´ ë‹¤ì‹œ ìë™ ì£¼ì œë¡œ ì „í™˜)
          selectTopic(idx, 'manual');
        });
        $menu.appendChild(b);
      });
      refreshMenuActive();
    }
    function refreshMenuActive(){
      const btns = $menu.querySelectorAll('button');
      btns.forEach(b => {
        const isActive = Number(b.dataset.idx) === state.topicIndex;
        b.classList.toggle('active', isActive);
      });
    }

    // ====== í† í”½ ì„ íƒ & ì˜¤ëŠ˜ ìˆœì„œ êµ¬ì„± ======
    function selectTopic(idx, reason='auto'){
      state.topicIndex = idx;
      const topic = TOPICS[idx];
      // í•˜ë£¨-í† í”½ ê³ ì • ì…”í”Œ: "YYYY-MM-DD|topicKey"ë¡œ ì‹œë“œ ê³ ì •
      state.todaysOrder = stableDailyShuffle(topic.lines, `${todayStrKST}|${topic.key}`);
      state.pointer = 0;
      // UI ê°±ì‹ 
      $topicLabel.textContent = topic.label;
      $topicTag.textContent = reason === 'auto' ? 'AUTO' : 'MANUAL';
      $currentTopic.textContent = `${topic.label}`;
      $lineCount.textContent = `${topic.lines.length}`;
      refreshMenuActive();
      showNextLine(true);
    }

    // ====== ë‹¤ìŒ ë¬¸ì¥ ë³´ì—¬ì£¼ê¸° (ì¤‘ë³µ ì—†ì´) ======
    function showNextLine(resetIfEnd=false){
      const lines = state.todaysOrder;
      if(lines.length === 0){
        $lineBox.textContent = 'ì´ í† í”½ì—ëŠ” ì•„ì§ ë¬¸ì¥ì´ ì—†ìŠµë‹ˆë‹¤.';
        $progress.textContent = '0 / 0';
        return;
      }
      if(state.pointer >= lines.length){
        if(resetIfEnd){
          state.pointer = 0; // ëê¹Œì§€ ë´¤ìœ¼ë©´ ì²˜ìŒë¶€í„° ì¬ì‹œì‘(ê·¸ë˜ë„ ì˜¤ëŠ˜ ìˆœì„œëŠ” ìœ ì§€ë˜ì–´ ì¤‘ë³µ ëŠë‚Œ ìµœì†Œí™”)
        } else {
          state.pointer = lines.length - 1; // ë°©ì–´
        }
      }
      const line = lines[state.pointer];
      $lineBox.textContent = line;
      $progress.textContent = `${state.pointer+1} / ${lines.length}`;
      state.pointer++;
    }

    // ====== ë‹¤ìŒ ìì •(KST) íƒ€ì´ë¨¸ ì„¤ì •: ìì •ì— ìë™ ì£¼ì œë¡œ ì „í™˜ ======
    function scheduleMidnightSwitch(){
      // KSTì—ì„œì˜ ë‹¤ìŒ ìì •ê¹Œì§€ ë‚¨ì€ ms ê³„ì‚°
      const now = new Date();
      const nowKSTStr = new Intl.DateTimeFormat('en-CA', { timeZone:'Asia/Seoul', hourCycle:'h23', hour:'2-digit', minute:'2-digit'}).format(now);
      // ë‹¤ìŒ ìì • ì‹œê° ë¬¸ìì—´ ë§Œë“¤ê¸°
      const today = new Date(now);
      const kstDateStr = toKSTDateString(today); // YYYY-MM-DD
      // ìì •(ë‹¤ìŒ ë‚  00:00 KST)ì˜ UTC ms ê³„ì‚°
      const nextDay = new Date(Date.parse(kstDateStr) + 86400000); // UTC ê¸°ì¤€ ë‹¤ìŒë‚  00:00
      const msUntil = nextDay.getTime() - Date.now();
      const etaMin = Math.max(0, Math.round(msUntil/60000));
      $nextMidnight.textContent = `ì•½ ${etaMin}ë¶„ í›„`;
      setTimeout(() => {
        // ë‚ ì§œ ë¬¸ìì—´ ê°±ì‹ 
        const newToday = toKSTDateString(new Date());
        if(newToday !== todayStrKST){
          // ìì •ì´ ì§€ë‚˜ë©´ ìë™ ì£¼ì œë¡œ ì „í™˜
          state.auto = true;
          const idx = getTodayTopicIndex();
          selectTopic(idx, 'auto');
          document.getElementById('todayStr').textContent = `KST ${newToday}`;
        } else {
          // í˜¹ì‹œ í™˜ê²½ì— ë”°ë¼ ë³€ë™ì´ ì—†ìœ¼ë©´ ì¬ìŠ¤ì¼€ì¤„
        }
        // ë‹¤ìŒ ìì •ë„ ë‹¤ì‹œ ìŠ¤ì¼€ì¤„
        scheduleMidnightSwitch();
      }, Math.max(1000, msUntil));
    }

    // ====== ì´ˆê¸°í™” ======
    function init(){
      renderMenu();
      const todayIdx = getTodayTopicIndex();
      $baseDateInfo.textContent = `ê¸°ì¤€: ${START_DATE_STR}`;
      $todayIdx.textContent = `${todayIdx+1} / ${TOPICS.length}`;
      selectTopic(todayIdx, 'auto');
      $nextBtn.addEventListener('click', () => showNextLine());
      scheduleMidnightSwitch();
    }

    init();
  </script>
</body>
</html>
